<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Version: 1.1.0-STANDALONE (Updated: 2024-05-20) -->
    <title>ShopTrack - ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞ (Standalone)</title>
    
    <!-- External Libraries (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Kanit', sans-serif;
            background-color: #f8fafc;
            margin: 0;
            -webkit-tap-highlight-color: transparent;
        }
        #root { min-height: 100vh; }
        
        /* Utility styles */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeIn { animation: fadeIn 0.4s ease-out; }
        .animate-slideUp { animation: fadeIn 0.5s cubic-bezier(0.16, 1, 0.3, 1); }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>

    <!-- Import Map for direct browser execution without build tools -->
    <script async src="https://ga.jspm.io/npm:es-module-shims@1.8.2/dist/es-module-shims.js"></script>
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.3.1",
    "react-dom": "https://esm.sh/react-dom@18.3.1",
    "react-dom/client": "https://esm.sh/react-dom@18.3.1/client",
    "react/jsx-runtime": "https://esm.sh/react@18.3.1/jsx-runtime",
    "recharts": "https://esm.sh/recharts@2.12.7?external=react,react-dom",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "vite": "https://esm.sh/vite@^7.3.1",
    "@vitejs/plugin-react": "https://esm.sh/@vitejs/plugin-react@^5.1.2"
  }
}
</script>
</head>
<body>
    <div id="root"></div>

    <!-- ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Script ‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß -->
    <script type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, 
            PieChart, Pie, Cell, LineChart, Line, Legend 
        } from 'recharts';

        // --- 1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (Constants) ---
        const CategoryType = {
            ICE: '‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á',
            SOFT_DRINK: '‡∏ô‡πâ‡∏≥‡∏≠‡∏±‡∏î‡∏•‡∏°',
            ENERGY_DRINK: '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏Å‡∏≥‡∏•‡∏±‡∏á',
            WATER: '‡∏ô‡πâ‡∏≥‡πÄ‡∏õ‡∏•‡πà‡∏≤',
            LIQUOR: '‡πÄ‡∏´‡∏•‡πâ‡∏≤',
            BEER: '‡πÄ‡∏ö‡∏µ‡∏¢‡∏£‡πå',
            CIGARETTE: '‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà',
            OTHERS: '‡∏≠‡∏∑‡πà‡∏ô‡πÜ'
        };

        const CATEGORIES_CONFIG = [
            { type: CategoryType.ICE, label: '‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á', image: 'https://images.unsplash.com/photo-1516139008210-96e45dccd83b?auto=format&fit=crop&q=80&w=400' },
            { type: CategoryType.SOFT_DRINK, label: '‡∏ô‡πâ‡∏≥‡∏≠‡∏±‡∏î‡∏•‡∏°', image: 'https://images.unsplash.com/photo-1622483767028-3f66f32aef97?auto=format&fit=crop&q=80&w=400' },
            { type: CategoryType.ENERGY_DRINK, label: '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏Å‡∏≥‡∏•‡∏±‡∏á', image: 'https://images.unsplash.com/photo-1622543953495-a92ee3951297?auto=format&fit=crop&q=80&w=400' },
            { type: CategoryType.WATER, label: '‡∏ô‡πâ‡∏≥‡πÄ‡∏õ‡∏•‡πà‡∏≤', image: 'https://images.unsplash.com/photo-1548839140-29a749e1cf3d?auto=format&fit=crop&q=80&w=400' },
            { type: CategoryType.LIQUOR, label: '‡πÄ‡∏´‡∏•‡πâ‡∏≤', image: 'https://images.unsplash.com/photo-1514362545857-3bc16c4c7d1b?auto=format&fit=crop&q=80&w=400' },
            { type: CategoryType.BEER, label: '‡πÄ‡∏ö‡∏µ‡∏¢‡∏£‡πå', image: 'https://images.unsplash.com/photo-1535958636474-b021ee887b13?auto=format&fit=crop&q=80&w=400' },
            { type: CategoryType.CIGARETTE, label: '‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà', image: 'https://images.unsplash.com/photo-1527113353670-4e21bd503bb1?auto=format&fit=crop&q=80&w=400' },
            { type: CategoryType.OTHERS, label: '‡∏≠‡∏∑‡πà‡∏ô‡πÜ', image: 'https://images.unsplash.com/photo-1583333222044-2e873b24652e?auto=format&fit=crop&q=80&w=400' },
        ];

        const PRODUCTS_BY_CATEGORY = {
            [CategoryType.ICE]: ['‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡πá‡∏Å', '‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á‡∏´‡∏•‡∏≠‡∏î‡πÉ‡∏´‡∏ç‡πà', '‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á‡∏ö‡∏î'],
            [CategoryType.SOFT_DRINK]: ['‡πÇ‡∏Ñ‡πâ‡∏Å', '‡πÄ‡∏õ‡πä‡∏õ‡∏ã‡∏µ‡πà', '‡πÅ‡∏ü‡∏ô‡∏ï‡πâ‡∏≤ ‡∏™‡πâ‡∏°', '‡∏™‡πÑ‡∏õ‡∏£‡∏ó‡πå', '‡πÄ‡∏ã‡πÄ‡∏ß‡πà‡∏ô‡∏≠‡∏±‡∏û'],
            [CategoryType.ENERGY_DRINK]: ['‡πÄ‡∏≠‡πá‡∏°-150', '‡∏Ñ‡∏≤‡∏£‡∏≤‡∏ö‡∏≤‡∏ß‡πÅ‡∏î‡∏á', '‡∏Å‡∏£‡∏∞‡∏ó‡∏¥‡∏á‡πÅ‡∏î‡∏á', '‡∏•‡∏¥‡πÇ‡∏û'],
            [CategoryType.WATER]: ['‡∏ô‡πâ‡∏≥‡πÄ‡∏õ‡∏•‡πà‡∏≤ 600ml', '‡∏ô‡πâ‡∏≥‡πÄ‡∏õ‡∏•‡πà‡∏≤ 1.5L', '‡∏ô‡πâ‡∏≥‡πÅ‡∏£‡πà'],
            [CategoryType.LIQUOR]: ['‡∏£‡∏µ‡πÄ‡∏à‡∏ô‡∏ã‡∏µ‡πà', '‡πÅ‡∏™‡∏á‡πÇ‡∏™‡∏°', '‡∏´‡∏á‡∏™‡πå‡∏ó‡∏≠‡∏á', '‡πÄ‡∏ö‡∏•‡∏ô‡∏î‡πå 285'],
            [CategoryType.BEER]: ['‡∏•‡∏µ‡πÇ‡∏≠', '‡∏ä‡πâ‡∏≤‡∏á', '‡∏™‡∏¥‡∏á‡∏´‡πå', '‡πÑ‡∏Æ‡πÄ‡∏ô‡πÄ‡∏Å‡πâ‡∏ô'],
            [CategoryType.CIGARETTE]: ['‡∏™‡∏≤‡∏¢‡∏ù‡∏ô', '‡∏Å‡∏£‡∏≠‡∏á‡∏ó‡∏¥‡∏û‡∏¢‡πå', '‡πÅ‡∏≠‡∏•‡πÄ‡∏≠‡πá‡∏°', '‡∏°‡∏≤‡∏£‡πå‡∏•‡πÇ‡∏ö‡πÇ‡∏£‡πà'],
            [CategoryType.OTHERS]: ['‡∏Ç‡∏ô‡∏°‡∏Ç‡∏ö‡πÄ‡∏Ñ‡∏µ‡πâ‡∏¢‡∏ß', '‡∏°‡∏≤‡∏°‡πà‡∏≤', '‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ'],
        };

        const COLORS = ['#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6', '#EC4899', '#06B6D4', '#64748B'];

        // --- 2. ‡∏Ñ‡∏≠‡∏°‡πÇ‡∏û‡πÄ‡∏ô‡∏ô‡∏ï‡πå Dashboard ---
        const Dashboard = ({ entries }) => {
            const [filter, setFilter] = useState('all');

            const filteredEntries = useMemo(() => {
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                return entries.filter(entry => {
                    const entryDate = new Date(entry.timestamp);
                    if (filter === 'day') return entryDate >= today;
                    if (filter === 'week') {
                        const lastWeek = new Date(today);
                        lastWeek.setDate(today.getDate() - 7);
                        return entryDate >= lastWeek;
                    }
                    if (filter === 'month') return entryDate.getMonth() === now.getMonth() && entryDate.getFullYear() === now.getFullYear();
                    if (filter === 'year') return entryDate.getFullYear() === now.getFullYear();
                    return true;
                });
            }, [entries, filter]);

            const categoryData = useMemo(() => {
                return Object.values(CategoryType).map(cat => ({
                    name: cat,
                    amount: filteredEntries.filter(e => e.category === cat).reduce((sum, e) => sum + e.totalPrice, 0),
                    quantity: filteredEntries.filter(e => e.category === cat).reduce((sum, e) => sum + e.quantity, 0),
                })).filter(d => d.amount > 0 || d.quantity > 0);
            }, [filteredEntries]);

            const productSummary = useMemo(() => {
                const summaryMap = {};
                filteredEntries.forEach(entry => {
                    if (!summaryMap[entry.productName]) {
                        summaryMap[entry.productName] = { quantity: 0, amount: 0, category: entry.category };
                    }
                    summaryMap[entry.productName].quantity += entry.quantity;
                    summaryMap[entry.productName].amount += entry.totalPrice;
                });
                return Object.entries(summaryMap).map(([name, data]) => ({ name, ...data })).sort((a, b) => b.amount - a.amount);
            }, [filteredEntries]);

            const totalAmount = filteredEntries.reduce((sum, e) => sum + e.totalPrice, 0);
            const totalQuantity = filteredEntries.reduce((sum, e) => sum + e.quantity, 0);

            const dailyData = useMemo(() => {
                const dataMap = {};
                filteredEntries.forEach(curr => {
                    const date = new Date(curr.timestamp).toLocaleDateString('th-TH', { day: '2-digit', month: '2-digit' });
                    dataMap[date] = (dataMap[date] || 0) + curr.totalPrice;
                });
                return Object.entries(dataMap).map(([date, amount]) => ({ date, amount }));
            }, [filteredEntries]);

            return React.createElement('div', { className: "space-y-6" },
                React.createElement('div', { className: "flex flex-wrap items-center justify-between gap-4 bg-white p-2 rounded-2xl shadow-sm border border-slate-100" },
                    React.createElement('div', { className: "flex bg-slate-100 p-1 rounded-xl" },
                        [{ id: 'all', label: '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' }, { id: 'day', label: '‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ' }, { id: 'week', label: '7 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î' }, { id: 'month', label: '‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ' }, { id: 'year', label: '‡∏õ‡∏µ‡∏ô‡∏µ‡πâ' }].map(t => 
                            React.createElement('button', {
                                key: t.id,
                                onClick: () => setFilter(t.id),
                                className: `px-4 py-2 rounded-lg text-xs font-bold transition-all ${filter === t.id ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`
                            }, t.label)
                        )
                    ),
                    React.createElement('div', { className: "px-4 text-xs font-bold text-slate-400 uppercase tracking-widest" }, `‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${filter}`)
                ),
                React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-4" },
                    React.createElement('div', { className: "bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex flex-col items-center justify-center" },
                        React.createElement('span', { className: "text-slate-500 text-sm mb-1 font-medium" }, "‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)"),
                        React.createElement('span', { className: "text-4xl font-bold text-blue-600" }, `‡∏ø${totalAmount.toLocaleString()}`)
                    ),
                    React.createElement('div', { className: "bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex flex-col items-center justify-center" },
                        React.createElement('span', { className: "text-slate-500 text-sm mb-1 font-medium" }, "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏ß‡∏° (‡∏´‡∏ô‡πà‡∏ß‡∏¢)"),
                        React.createElement('span', { className: "text-4xl font-bold text-emerald-600" }, `${totalQuantity.toLocaleString()}`)
                    )
                ),
                React.createElement('div', { className: "bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden" },
                    React.createElement('div', { className: "p-6 border-b border-slate-50 flex justify-between items-center bg-slate-50/50" },
                        React.createElement('h3', { className: "text-lg font-bold text-slate-800" }, "‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤"),
                        React.createElement('span', { className: "bg-blue-100 text-blue-600 px-3 py-1 rounded-full text-[10px] font-black uppercase" }, `${productSummary.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`)
                    ),
                    React.createElement('div', { className: "overflow-x-auto" },
                        React.createElement('table', { className: "w-full text-left border-collapse" },
                            React.createElement('thead', null,
                                React.createElement('tr', { className: "bg-slate-50 text-slate-500 text-[10px] uppercase tracking-wider font-bold" },
                                    ['‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', '‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà', '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô', '‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô'].map(h => React.createElement('th', { className: `px-6 py-4 ${h.includes('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô') || h.includes('‡πÄ‡∏á‡∏¥‡∏ô') ? 'text-right' : ''}` }, h))
                                )
                            ),
                            React.createElement('tbody', { className: "divide-y divide-slate-100" },
                                productSummary.length > 0 ? productSummary.map((item, idx) => 
                                    React.createElement('tr', { key: idx, className: "hover:bg-blue-50/30 transition-colors" },
                                        React.createElement('td', { className: "px-6 py-4 font-bold text-slate-700" }, item.name),
                                        React.createElement('td', { className: "px-6 py-4 text-slate-500 text-xs" }, item.category),
                                        React.createElement('td', { className: "px-6 py-4 text-right font-bold text-emerald-600" }, item.quantity.toLocaleString()),
                                        React.createElement('td', { className: "px-6 py-4 text-right font-black text-slate-900" }, `‡∏ø${item.amount.toLocaleString()}`)
                                    )
                                ) : React.createElement('tr', null, React.createElement('td', { colSpan: 4, className: "px-6 py-10 text-center text-slate-400 italic" }, "-- ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• --"))
                            ),
                            productSummary.length > 0 && React.createElement('tfoot', { className: "bg-slate-900 text-white" },
                                React.createElement('tr', null,
                                    React.createElement('td', { colSpan: 2, className: "px-6 py-4 font-bold text-sm" }, "‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô"),
                                    React.createElement('td', { className: "px-6 py-4 text-right font-black text-emerald-400" }, totalQuantity.toLocaleString()),
                                    React.createElement('td', { className: "px-6 py-4 text-right font-black text-blue-400" }, `‡∏ø${totalAmount.toLocaleString()}`)
                                )
                            )
                        )
                    )
                ),
                React.createElement('div', { className: "grid grid-cols-1 lg:grid-cols-2 gap-6" },
                    React.createElement('div', { className: "bg-white p-6 rounded-2xl shadow-sm border border-slate-100 h-80" },
                        React.createElement('h3', { className: "text-lg font-bold mb-4 text-slate-400 uppercase text-xs tracking-widest" }, "‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)"),
                        React.createElement(ResponsiveContainer, { width: "100%", height: "100%" },
                            React.createElement(BarChart, { data: categoryData },
                                React.createElement(CartesianGrid, { strokeDasharray: "3 3", vertical: false, stroke: "#f1f5f9" }),
                                React.createElement(XAxis, { dataKey: "name", fontSize: 10, tick: { fill: '#64748b' }, interval: 0 }),
                                React.createElement(YAxis, { fontSize: 10, tick: { fill: '#64748b' } }),
                                React.createElement(Tooltip, { cursor: { fill: '#f8fafc' }, contentStyle: { borderRadius: '12px', border: 'none', boxShadow: '0 4px 12px rgba(0,0,0,0.1)' } }),
                                React.createElement(Bar, { dataKey: "amount", fill: "#3B82F6", radius: [4, 4, 0, 0] })
                            )
                        )
                    ),
                    React.createElement('div', { className: "bg-white p-6 rounded-2xl shadow-sm border border-slate-100 h-80" },
                        React.createElement('h3', { className: "text-lg font-bold mb-4 text-slate-400 uppercase text-xs tracking-widest" }, "‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤"),
                        React.createElement(ResponsiveContainer, { width: "100%", height: "100%" },
                            React.createElement(PieChart, null,
                                React.createElement(Pie, { data: categoryData, dataKey: "quantity", nameKey: "name", cx: "50%", cy: "50%", innerRadius: 60, outerRadius: 80, paddingAngle: 5 },
                                    categoryData.map((entry, index) => React.createElement(Cell, { key: `cell-${index}`, fill: COLORS[index % COLORS.length] }))
                                ),
                                React.createElement(Tooltip, { contentStyle: { borderRadius: '12px', border: 'none', boxShadow: '0 4px 12px rgba(0,0,0,0.1)' } }),
                                React.createElement(Legend, { verticalAlign: "bottom", iconType: "circle", wrapperStyle: { fontSize: '10px', fontWeight: 'bold' } })
                            )
                        )
                    )
                )
            );
        };

        // --- 3. ‡∏Ñ‡∏≠‡∏°‡πÇ‡∏û‡πÄ‡∏ô‡∏ô‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å App ---
        const App = () => {
            const [view, setView] = useState('dashboard');
            const [step, setStep] = useState('category');
            const [entries, setEntries] = useState([]);
            const [iceDebtEntries, setIceDebtEntries] = useState([]);
            const [customerDebtEntries, setCustomerDebtEntries] = useState([]);
            const [selectedCategory, setSelectedCategory] = useState(null);
            const [sheetUrl, setSheetUrl] = useState(localStorage.getItem('shoptrack_url') || '');
            
            const [productName, setProductName] = useState('');
            const [quantity, setQuantity] = useState('');
            const [price, setPrice] = useState('');
            const [deliveredBags, setDeliveredBags] = useState('');
            const [collectedBags, setCollectedBags] = useState('');
            const [iceNote, setIceNote] = useState('');
            const [manualPrevDebt, setManualPrevDebt] = useState('');
            const [debtCustName, setDebtCustName] = useState('');
            const [debtItemName, setDebtItemName] = useState('');
            const [debtQty, setDebtQty] = useState('');
            const [debtAmount, setDebtAmount] = useState('');
            const [isSubmitting, setIsSubmitting] = useState(false);

            useEffect(() => {
                const saved = localStorage.getItem('shop_entries');
                const savedIce = localStorage.getItem('ice_debt_entries');
                const savedCust = localStorage.getItem('customer_debt_entries');
                if (saved) setEntries(JSON.parse(saved));
                if (savedIce) setIceDebtEntries(JSON.parse(savedIce));
                if (savedCust) setCustomerDebtEntries(JSON.parse(savedCust));
            }, []);

            useEffect(() => {
                localStorage.setItem('shop_entries', JSON.stringify(entries));
                localStorage.setItem('ice_debt_entries', JSON.stringify(iceDebtEntries));
                localStorage.setItem('customer_debt_entries', JSON.stringify(customerDebtEntries));
            }, [entries, iceDebtEntries, customerDebtEntries]);

            const currentIceDebt = iceDebtEntries.length > 0 ? iceDebtEntries[0].currentDebt : 0;
            useEffect(() => { if (view === 'ice-debt') setManualPrevDebt(currentIceDebt.toString()); }, [view, currentIceDebt]);

            const categorySummary = useMemo(() => {
                const summary = {};
                entries.forEach(entry => {
                    if (!summary[entry.category]) summary[entry.category] = { quantity: 0, amount: 0 };
                    summary[entry.category].quantity += entry.quantity;
                    summary[entry.category].amount += entry.totalPrice;
                });
                return summary;
            }, [entries]);

            const saveProductDirectly = () => {
                const qtyVal = parseFloat(quantity) || 0;
                const priceVal = parseFloat(price) || 0;
                if (!selectedCategory || !productName || qtyVal <= 0) return;
                const newEntry = { id: Math.random().toString(36).substr(2, 9), timestamp: new Date().toISOString(), category: selectedCategory, productName, quantity: qtyVal, totalPrice: priceVal, isSynced: false };
                setEntries(prev => [newEntry, ...prev]);
                setProductName(''); setQuantity(''); setPrice(''); setStep('category'); setSelectedCategory(null); setView('dashboard');
            };

            const handleIceDebtSave = () => {
                const prev = parseFloat(manualPrevDebt) || 0;
                const del = parseFloat(deliveredBags) || 0;
                const col = parseFloat(collectedBags) || 0;
                const newIceEntry = { id: Math.random().toString(36).substr(2, 9), timestamp: new Date().toISOString(), previousDebt: prev, deliveredBags: del, collectedBags: col, currentDebt: prev + del - col, note: iceNote, isSynced: false };
                setIceDebtEntries(prevArr => [newIceEntry, ...prevArr]);
                setDeliveredBags(''); setCollectedBags(''); setIceNote(''); setView('dashboard');
                alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ñ‡∏∏‡∏á‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á‡∏Ñ‡πâ‡∏≤‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            };

            const handleAddCustomerDebt = () => {
                if (!debtCustName || !debtItemName) return;
                const newEntry = { id: Math.random().toString(36).substr(2, 9), timestamp: new Date().toISOString(), customerName: debtCustName, itemName: debtItemName, quantity: parseFloat(debtQty) || 0, amount: parseFloat(debtAmount) || 0, isSynced: false };
                setCustomerDebtEntries(prev => [newEntry, ...prev]);
                setDebtCustName(''); setDebtItemName(''); setDebtQty(''); setDebtAmount('');
                alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
            };

            const syncToGoogleSheets = async () => {
                if (!sheetUrl) { alert('‚ö†Ô∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ Settings ‡∏Å‡πà‡∏≠‡∏ô'); setView('settings'); return; }
                const unsyncedEntries = entries.filter(e => !e.isSynced);
                const unsyncedIce = iceDebtEntries.filter(e => !e.isSynced);
                const unsyncedCust = customerDebtEntries.filter(e => !e.isSynced);
                if (!unsyncedEntries.length && !unsyncedIce.length && !unsyncedCust.length) {
                    alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á');
                    return;
                }
                setIsSubmitting(true);
                try {
                    await fetch(sheetUrl, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ products: unsyncedEntries, iceDebt: unsyncedIce, customerDebt: unsyncedCust }) });
                    setEntries(prev => prev.map(e => ({ ...e, isSynced: true })));
                    setIceDebtEntries(prev => prev.map(e => ({ ...e, isSynced: true })));
                    setCustomerDebtEntries(prev => prev.map(e => ({ ...e, isSynced: true })));
                    alert('üöÄ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheets ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!');
                } catch (e) { alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + e.message); } finally { setIsSubmitting(false); }
            };

            const unsyncedCount = entries.filter(e => !e.isSynced).length + iceDebtEntries.filter(e => !e.isSynced).length + customerDebtEntries.filter(e => !e.isSynced).length;

            return React.createElement('div', { className: "min-h-screen bg-slate-50 pb-32 lg:pb-8 text-slate-900" },
                React.createElement('header', { className: "bg-white border-b border-slate-200 sticky top-0 z-30 px-6 py-4 shadow-sm" },
                    React.createElement('div', { className: "max-w-5xl mx-auto flex justify-between items-center" },
                        React.createElement('div', { className: "flex items-center gap-2 cursor-pointer", onClick: () => setView('dashboard') },
                            React.createElement('div', { className: "w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center text-white font-black text-xl shadow-lg" }, "S"),
                            React.createElement('span', { className: "text-xl font-bold tracking-tight" }, "ShopTrack Standalone")
                        ),
                        React.createElement('div', { className: "flex items-center gap-3" },
                            React.createElement('button', { onClick: syncToGoogleSheets, disabled: isSubmitting || unsyncedCount === 0, className: `flex items-center gap-2 px-5 py-2.5 rounded-full text-sm font-bold transition-all shadow-md ${unsyncedCount > 0 ? 'bg-amber-500 text-white animate-pulse' : 'bg-emerald-50 text-emerald-600 border border-emerald-100'}` }, 
                                isSubmitting ? '‚åõ...' : 'üìã ' + (unsyncedCount > 0 ? `‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (${unsyncedCount})` : '‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡πÅ‡∏•‡πâ‡∏ß')
                            ),
                            React.createElement('button', { onClick: () => setView('settings'), className: "text-slate-400 hover:bg-slate-100 w-10 h-10 flex items-center justify-center rounded-full" }, "‚öôÔ∏è")
                        )
                    )
                ),
                React.createElement('main', { className: "max-w-5xl mx-auto px-6 py-8" },
                    view === 'dashboard' && React.createElement('div', { className: "space-y-8 animate-fadeIn" },
                        React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-3 gap-6" },
                            React.createElement('div', { className: "md:col-span-2 bg-slate-900 p-8 rounded-[2rem] text-white shadow-2xl relative overflow-hidden" },
                                React.createElement('h2', { className: "text-blue-400 font-bold text-sm tracking-widest uppercase mb-1" }, "DASHBOARD"),
                                React.createElement('p', { className: "text-2xl font-bold" }, "‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå"),
                                React.createElement('div', { className: "flex gap-2 mt-4 relative z-10" },
                                    React.createElement('button', { onClick: () => setView('customer-debt'), className: "px-4 py-2 bg-slate-800 hover:bg-slate-700 text-white rounded-xl text-xs font-bold" }, "üë§ ‡∏Ñ‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á"),
                                    React.createElement('button', { onClick: () => setView('ice-debt'), className: "px-4 py-2 bg-slate-800 hover:bg-slate-700 text-white rounded-xl text-xs font-bold" }, "üßä ‡∏ñ‡∏∏‡∏á‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á")
                                )
                            ),
                            React.createElement('div', { className: "bg-white p-8 rounded-[2rem] border border-slate-100 shadow-xl flex flex-col justify-center items-center text-center" },
                                React.createElement('span', { className: "text-slate-400 text-sm font-bold mb-2" }, "üßä ‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á‡∏Ñ‡πâ‡∏≤‡∏á‡∏™‡∏∞‡∏™‡∏°"),
                                React.createElement('span', { className: "text-5xl font-black" }, currentIceDebt.toLocaleString()),
                                React.createElement('button', { onClick: () => setView('ice-debt'), className: "mt-4 px-6 py-2 bg-blue-50 text-blue-600 rounded-full text-xs font-bold" }, "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ñ‡∏∏‡∏á‡∏Ñ‡πâ‡∏≤‡∏á")
                            )
                        ),
                        React.createElement(Dashboard, { entries })
                    ),
                    view === 'entry' && React.createElement('div', { className: "animate-slideUp max-w-4xl mx-auto" },
                        step === 'category' ? React.createElement('div', { className: "space-y-8 text-center" },
                            React.createElement('h2', { className: "text-3xl font-black" }, "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤"),
                            React.createElement('div', { className: "grid grid-cols-2 md:grid-cols-4 gap-6" },
                                CATEGORIES_CONFIG.map(cat => 
                                    React.createElement('button', { key: cat.type, onClick: () => { setSelectedCategory(cat.type); setStep('details'); }, className: "group bg-white rounded-[2rem] border border-slate-100 hover:border-blue-300 hover:shadow-2xl transition-all overflow-hidden" },
                                        React.createElement('div', { className: "w-full h-32 overflow-hidden" }, React.createElement('img', { src: cat.image, className: "w-full h-full object-cover group-hover:scale-110 transition-transform" })),
                                        React.createElement('div', { className: "p-5 font-bold" }, cat.label)
                                    )
                                )
                            )
                        ) : React.createElement('div', { className: "bg-white rounded-[2.5rem] p-10 border border-slate-100 shadow-2xl max-w-2xl mx-auto space-y-8" },
                            React.createElement('div', { className: "flex items-center gap-4" },
                                React.createElement('button', { onClick: () => setStep('category'), className: "w-10 h-10 flex items-center justify-center bg-slate-100 rounded-full" }, "‚¨ÖÔ∏è"),
                                React.createElement('h2', { className: "text-2xl font-black" }, selectedCategory)
                            ),
                            React.createElement('div', { className: "space-y-6" },
                                React.createElement('div', null,
                                    React.createElement('label', { className: "block text-sm font-black text-slate-700 mb-3 uppercase" }, "‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤"),
                                    React.createElement('div', { className: "flex flex-wrap gap-2 mb-4" },
                                        PRODUCTS_BY_CATEGORY[selectedCategory]?.map(name => React.createElement('button', { key: name, onClick: () => setProductName(name), className: `px-4 py-2 rounded-xl text-xs font-bold border ${productName === name ? 'bg-blue-600 text-white' : 'bg-slate-50 text-slate-500'}` }, name))
                                    ),
                                    React.createElement('input', { value: productName, onChange: e => setProductName(e.target.value), className: "w-full px-5 py-4 rounded-2xl bg-slate-50 border outline-none font-bold" })
                                ),
                                React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                                    React.createElement('div', null, React.createElement('label', { className: "block text-sm font-black" }, "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô"), React.createElement('input', { type: "number", value: quantity, onChange: e => setQuantity(e.target.value), className: "w-full px-5 py-4 rounded-2xl bg-slate-50 border font-black text-lg" })),
                                    React.createElement('div', null, React.createElement('label', { className: "block text-sm font-black" }, "‡∏£‡∏≤‡∏Ñ‡∏≤"), React.createElement('input', { type: "number", value: price, onChange: e => setPrice(e.target.value), className: "w-full px-5 py-4 rounded-2xl bg-slate-50 border-2 border-blue-100 font-black text-lg" }))
                                ),
                                React.createElement('button', { onClick: saveProductDirectly, className: "w-full bg-blue-600 text-white py-5 rounded-2xl font-black text-xl shadow-lg" }, "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•")
                            )
                        )
                    ),
                    view === 'settings' && React.createElement('div', { className: "animate-slideUp max-w-3xl mx-auto space-y-6" },
                        React.createElement('div', { className: "bg-white p-10 rounded-[2.5rem] border border-slate-100 shadow-2xl space-y-8" },
                            React.createElement('h2', { className: "text-3xl font-black" }, "‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠"),
                            React.createElement('p', { className: "text-sm text-slate-500" }, "‡∏Å‡∏£‡∏≠‡∏Å URL ‡∏Ç‡∏≠‡∏á Google Apps Script ‡∏ó‡∏µ‡πà Deploy ‡πÄ‡∏õ‡πá‡∏ô Web App ‡πÑ‡∏ß‡πâ"),
                            React.createElement('input', { value: sheetUrl, onChange: e => setSheetUrl(e.target.value), className: "w-full px-5 py-4 rounded-2xl bg-slate-50 border outline-none font-mono text-xs", placeholder: "https://script.google.com/macros/s/.../exec" }),
                            React.createElement('button', { onClick: () => { localStorage.setItem('shoptrack_url', sheetUrl); alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å URL ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!'); }, className: "w-full bg-slate-900 text-white py-4 rounded-2xl font-black" }, "üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤")
                        )
                    ),
                    view === 'ice-debt' && React.createElement('div', { className: "animate-slideUp max-w-2xl mx-auto" },
                        React.createElement('div', { className: "bg-white p-10 rounded-[2.5rem] border border-slate-100 shadow-2xl space-y-8" },
                            React.createElement('h2', { className: "text-2xl font-black" }, "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ñ‡∏∏‡∏á‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á"),
                            React.createElement('div', { className: "p-6 bg-blue-50 rounded-2xl border border-blue-100" },
                                React.createElement('p', { className: "text-xs font-bold text-blue-400" }, "‡∏Ñ‡πâ‡∏≤‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô"),
                                React.createElement('p', { className: "text-3xl font-black text-blue-900" }, `${currentIceDebt} ‡∏ñ‡∏∏‡∏á`)
                            ),
                            React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                                React.createElement('div', null, React.createElement('label', { className: "text-xs font-bold" }, "‡∏™‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°"), React.createElement('input', { type: "number", value: deliveredBags, onChange: e => setDeliveredBags(e.target.value), placeholder: "0", className: "w-full px-5 py-4 rounded-2xl bg-slate-50 border font-black" })),
                                React.createElement('div', null, React.createElement('label', { className: "text-xs font-bold" }, "‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏∑‡∏ô"), React.createElement('input', { type: "number", value: collectedBags, onChange: e => setCollectedBags(e.target.value), placeholder: "0", className: "w-full px-5 py-4 rounded-2xl bg-slate-50 border font-black" }))
                            ),
                            React.createElement('button', { onClick: handleIceDebtSave, className: "w-full bg-blue-600 text-white py-5 rounded-2xl font-black" }, "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å")
                        )
                    ),
                    view === 'customer-debt' && React.createElement('div', { className: "animate-slideUp max-w-2xl mx-auto" },
                        React.createElement('div', { className: "bg-white p-10 rounded-[2.5rem] border border-slate-100 shadow-2xl space-y-8" },
                            React.createElement('h2', { className: "text-2xl font-black" }, "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á‡∏à‡πà‡∏≤‡∏¢"),
                            React.createElement('input', { value: debtCustName, onChange: e => setDebtCustName(e.target.value), placeholder: "‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤", className: "w-full px-5 py-4 rounded-2xl bg-slate-50 border font-bold" }),
                            React.createElement('input', { value: debtItemName, onChange: e => setDebtItemName(e.target.value), placeholder: "‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏≤‡∏á", className: "w-full px-5 py-4 rounded-2xl bg-slate-50 border font-bold" }),
                            React.createElement('div', { className: "grid grid-cols-2 gap-4" },
                                React.createElement('input', { type: "number", value: debtQty, onChange: e => setDebtQty(e.target.value), placeholder: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô", className: "w-full px-5 py-4 rounded-2xl bg-slate-50 border font-black" }),
                                React.createElement('input', { type: "number", value: debtAmount, onChange: e => setDebtAmount(e.target.value), placeholder: "‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á (‡∏ö‡∏≤‡∏ó)", className: "w-full px-5 py-4 rounded-2xl bg-slate-50 border font-black" })
                            ),
                            React.createElement('button', { onClick: handleAddCustomerDebt, className: "w-full bg-slate-900 text-white py-5 rounded-2xl font-black" }, "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤‡∏á")
                        )
                    )
                ),
                React.createElement('nav', { className: "fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-xl border-t p-4 pb-10 flex justify-around items-end lg:hidden shadow-lg z-40" },
                    [{ id: 'dashboard', icon: 'üìä' }, { id: 'customer-debt', icon: 'üë§' }].map(m => 
                        React.createElement('button', { key: m.id, onClick: () => setView(m.id), className: `flex flex-col items-center gap-1 ${view === m.id ? 'text-blue-600' : 'text-slate-400'}` }, 
                            React.createElement('span', { className: "text-2xl" }, m.icon), React.createElement('span', { className: "text-[10px] font-bold uppercase" }, m.id)
                        )
                    ),
                    React.createElement('div', { className: "relative -mt-10" },
                        React.createElement('button', { onClick: () => { setView('entry'); setStep('category'); }, className: "bg-blue-600 text-white w-20 h-20 rounded-full shadow-xl flex items-center justify-center text-4xl border-[6px] border-white active:scale-90" }, "+")
                    ),
                    [{ id: 'ice-debt', icon: 'üßä' }, { id: 'settings', icon: '‚öôÔ∏è' }].map(m => 
                        React.createElement('button', { key: m.id, onClick: () => setView(m.id), className: `flex flex-col items-center gap-1 ${view === m.id ? 'text-blue-600' : 'text-slate-400'}` }, 
                            React.createElement('span', { className: "text-2xl" }, m.icon), React.createElement('span', { className: "text-[10px] font-bold uppercase" }, m.id)
                        )
                    )
                )
            );
        };

        // --- 4. ‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (Render) ---
        const rootElement = document.getElementById('root');
        const root = createRoot(rootElement);
        root.render(React.createElement(App));
    </script>
</body>
</html>